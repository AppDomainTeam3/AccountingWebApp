{% extends 'base.html' %}

  {%block title%} {{title}} {%endblock%}

    {%block content%}
      <div class="container-fluid">
        <h1 id="TableHeader" class="pt-2">Username's Trial Balance</h1>
        <table class="table table-striped table-bordered TrialBalanceDataTable" style="width: 100%">
          <thead>
            <tr>
              <th colspan="1">Category</th>
              <th colspan="1">Debits</th>
              <th colspan="1">Credits</th>
            </tr>
          </thead>

          <tbody>
            <tr>
              <td>Cash</td>
              <td id="CashDebits"></td>
              <td id="CashCredits"></td>
            </tr>
            <tr>
              <td>Accounts Receivable</td>
              <td id="AccountsReceivableDebits"></td>
              <td id="AccountsReceivableCredits"></td>
            </tr>
            <tr>
              <td>Land</td>
              <td id="LandDebits"></td>
              <td id="LandCredits"></td>
            </tr>
            <tr>
              <td>Notes Payable</td>
              <td id="NotesPayableDebits"></td>
              <td id="NotesPayableCredits"></td>
            </tr>
            <tr>
              <td>Capital Stock</td>
              <td id="CapitalStockDebits"></td>
              <td id="CapitalStockCredits"></td>
            </tr>
            <tr>
              <td>Service Revenues</td>
              <td id="ServiceRevenuesDebits"></td>
              <td id="ServiceRevenuesCredits"></td>
            </tr>
            <tr>
              <td>Advertising Expense</td>
              <td id="AdvertisingExpenseDebits"></td>
              <td id="AdvertisingExpenseCredits"></td>
            </tr>
            <tr>
              <td>Utilities Expense</td>
              <td id="UtilitiesExpenseDebits"></td>
              <td id="UtilitiesExpenseCredits"></td>
            </tr>
          </tbody>

          <tfoot>
            <th colspan="3"></th>
          </tfoot>
        </table>
      </div>
    {%endblock%}

    {%block script%}
      <script src="../static/js/Helper.js"></script>

      <script id="TrialBalanceDataTable">
        $('.TrialBalanceDataTable').DataTable({
            order: [],
            pagingType: 'full_numbers'
        });
      </script>

      <script id="journalData">
          var userID = getQueryVariable("userID");
          var username = "";
          var accountNumbers = [];
          var journalEntries = [];

          async function setUsername() {
            let response = await fetch("{{ api_url }}/users?id=" + userID);
            let userJSON = await response.json();
            
            username = userJSON[0]["username"];
          }

          async function setAccountNumbers() {
            let response = await fetch("{{ api_url }}/users/" + userID + "/accounts");
            let accountsJSON = await response.json();

            let i;
            for (i = 0; i < accountsJSON.length; i++) {
              accountNumbers.push(accountsJSON[i]["AccountNumber"]);
            }
          }

          async function setJournalEntries() {
            let i;
            for (i = 0; i < accountNumbers.length; i++) {

              let srcJournalEntriesResponse = await fetch("{{ api_url }}/journals?SourceAccountNumber=" + accountNumbers[i]);
              let srcJSON = await srcJournalEntriesResponse.json();
              let j;
              for (j = 0; j < srcJSON.length; j++) {
                if (srcJSON[j]["Status"] == "Approved") {
                  journalEntries.push(srcJSON[j]);   //Push srcJournalEntries to journalEntries
                }
              }

              let destJournalEntriesResponse = await fetch("{{ api_url }}/journals?DestAccountNumber=" + accountNumbers[i]);
              let destJSON = await destJournalEntriesResponse.json();
              for (j = 0; j < destJSON.length; j++) {
                if (destJSON[j]["Status"] == "Approved") {
                  journalEntries.push(destJSON[j]);   //Push destJournalEntries to journalEntries
                }
              }
            }
          }

          setUsername().then(() => {
            console.log(username);    //For debugging
            document.getElementById("TableHeader").innerHTML = username + "'s Trial Balance";
          });

          setAccountNumbers().then(() => {
            console.log(accountNumbers);    //For debugging
            setJournalEntries().then(() => {
              console.log(journalEntries);    //For debugging
            });
          });

      </script>
    {%endblock%}